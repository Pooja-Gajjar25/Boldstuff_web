
<div class="card-wrapper">
<div class="card-product">
    <div class="card card--product" tabindex="-1">
      <div class="card__inner ">
        <a href="{{ product_card_product.url | default: '#' }}" class="full-unstyled-link">
        {%- if product_card_product.featured_media -%}
          {%- liquid
            assign featured_media_aspect_ratio = product_card_product.featured_media.aspect_ratio

            if product_card_product.featured_media.aspect_ratio == nil
              assign featured_media_aspect_ratio = 1
            endif
          -%}
            <div class="thumbnail media media--transparent media--{{ media_size }} media--hover-effect"
              {% if media_size == 'adapt' and product_card_product.featured_media %} style="padding-bottom: {{ 1 | divided_by: featured_media_aspect_ratio | times: 100 }}%;"{% endif %}
            >
              <img srcset="{%- if product_card_product.featured_media.width >= 165 -%}{{ product_card_product.featured_media | img_url: '165x' }} 165w,{%- endif -%}
                {%- if product_card_product.featured_media.width >= 360 -%}{{ product_card_product.featured_media | img_url: '360x' }} 360w,{%- endif -%}
                {%- if product_card_product.featured_media.width >= 533 -%}{{ product_card_product.featured_media | img_url: '533x' }} 533w,{%- endif -%}
                {%- if product_card_product.featured_media.width >= 720 -%}{{ product_card_product.featured_media | img_url: '720x' }} 720w,{%- endif -%}
                {%- if product_card_product.featured_media.width >= 940 -%}{{ product_card_product.featured_media | img_url: '940x' }} 940w,{%- endif -%}
                {%- if product_card_product.featured_media.width >= 1066 -%}{{ product_card_product.featured_media | img_url: '1066x' }} 1066w,{%- endif -%}
                           {{ product_card_product.featured_media | img_url: 'master' }} {{ product_card_product.featured_media.width }}w"
                data-src="{{ product_card_product.featured_media | img_url: 'master' }}"
                sizes="(min-width: 1100px) 535px, (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)"
                alt="{{ product_card_product.featured_media.alt | escape }}"
                loading="lazy"
                class="motion-reduce lazyload primary-image"
                width="{{ product_card_product.featured_media.width }}"
                height="{{ product_card_product.featured_media.height }}"
              >

              {%- if product_card_product.media[1] != nil and show_secondary_image -%}
                <img srcset="{%- if product_card_product.media[1].width >= 165 -%}{{ product_card_product.media[1] | img_url: '165x' }} 165w,{%- endif -%}
                  {%- if product_card_product.media[1].width >= 360 -%}{{ product_card_product.media[1] | img_url: '360x' }} 360w,{%- endif -%}
                  {%- if product_card_product.media[1].width >= 533 -%}{{ product_card_product.media[1] | img_url: '533x' }} 533w,{%- endif -%}
                  {%- if product_card_product.media[1].width >= 720 -%}{{ product_card_product.media[1] | img_url: '720x' }} 720w,{%- endif -%}
                  {%- if product_card_product.media[1].width >= 940 -%}{{ product_card_product.media[1] | img_url: '940x' }} 940w,{%- endif -%}
                  {%- if product_card_product.media[1].width >= 1066 -%}{{ product_card_product.media[1] | img_url: '1066x' }} 1066w,{%- endif -%}
                             {{ product_card_product.media[1] | img_url: 'master' }} {{ product_card_product.media[1].width }}w"
                  data-src="{{ product_card_product.media[1] | img_url: 'master' }}"
                  sizes="(min-width: 1100px) 535px, (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)"
                  alt="{{ product_card_product.media[1].alt | escape }}"
                  loading="lazy"
                  class="motion-reduce lazyload"
                width="{{ product_card_product.media[1].width }}"
                height="{{ product_card_product.media[1].height }}"
                >
              {%- endif -%}
            </div>
        	{%- if product_card_product.available == false and settings.show_soldout -%}
               <span class="outstock-overlay">{{ 'products.product.sold_out' | t }}</span>
        	{%- endif -%}
        {%- else -%}
          <div class="card__content"><h2 class="card__text h2">{{ product_card_product.title }}</h2></div>
        {%- endif -%}
        </a>
        
		{%- if product_card_product.compare_at_price > product_card_product.price and product_card_product.available and settings.show_sale -%} 
          <div class="product-flags ">
            <span class="flag sale">{{ 'products.product.on_sale' | t }}</span>
          </div>
        {%- endif -%}
        {% if template.name != 'cart' and template.name != '404' %}
          {%- if settings.show_quickview or settings.show_wishlist or settings.show_cart-%}
          	<span class="mobile-review">
          {% endif %}
        {% endif %}
        <div class='jdgm-widget jdgm-preview-badge spr-badge' data-id="{{ product_card_product.id }}">
  {{ product_card_product.metafields.judgeme.badge }} 
</div>
        {% if template.name != 'cart' and template.name != '404' %}
          {%- if settings.show_quickview or settings.show_wishlist or settings.show_cart-%}
          	</span>
          {% endif %}
        {% endif %}
           {% if template.name != 'cart' and template.name != '404' %}
          <div class="thumbnail-buttons">
            {%- if settings.show_quickview -%}
              <quickview-opener class="product-popup-modal__opener no-js-hidden btn-info quick-view" data-handle="{{ product_card_product.handle }}" data-modal="#qvPopupModal">
                <div class="product-popup-modal__button link" type="button" aria-haspopup="dialog" data-href="#qvPopupModal" data-toggle="popover" aria-expanded="false">
                    {% render 'icons' with 'quickview' %}
                </div>
              </quickview-opener>
            {%- endif -%}
            {%- if settings.show_wishlist -%}
              <div class="btn-info wishlist">
                <div class="add-to-wishlist">     
                  <div class="show">
                    <div class="default-wishbutton-{{ product_card_product.handle }} loading"><a class="add-in-wishlist-js" data-href="{{ product_card_product.handle | handleize }}">{% render 'icons' with 'wishlist-outline' %}<span class="tooltip-label">{{ 'products.wishlist.add_to_wishlist' | t }}</span></a></div>
                    <div class="loadding-wishbutton-{{ product_card_product.handle }} loading loader-btn" style="display: none; pointer-events: none"><a class="add_to_wishlist" data-href="{{ product_card_product.handle | handleize }}"><i class="fa fa-circle-o-notch fa-spin"></i></a></div>
                    <div class="added-wishbutton-{{ product_card_product.handle }} loading" style="display: none;"><a class="added-wishlist add_to_wishlist" href="/pages/wishlist">{% render 'icons' with 'wishlist' %}<span class="tooltip-label">{{ 'products.wishlist.view_wishlist' | t }}</span></a></div>
                  </div>
                </div>
              </div>
            {%- endif -%}
          
          </div>
        {% endif %}
      </div>
    </div>
</div>
    <div class="card-information">
      <div class="card-information__wrapper">
        {%- if show_vendor -%}
          <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
          <div class="caption-with-letter-spacing vendor">{{ product_card_product.vendor }}</div>
        {%- endif -%}
          <span class="card-information__text h5">
            <a href="{{ product_card_product.url | default: '#' }}" class="full-unstyled-link">
            {{ product_card_product.title | escape }}
            </a>
          </span>
        {% comment %} TODO: metafield {% endcomment %}
        <span class="caption-large light">{{ block.settings.description | escape }}</span>

        {% render 'price', product: product_card_product, price_class: '' %}
      {% assign variantCount = product_card_product.variants | size %}
      {% if variantCount > 0  and product_card_product.variants.first.title != 'Default Title' %}
          <div class="variants-swatch">
             {% assign product = product_card_product %}
            {%- assign color_label = 'color,colour,couleur,colore,farbe,색,色,färg,farve' | split: ',' -%}
                      {% assign colorCount = 1 %}
                       {% assign optionCount = '' %}
                      {%- for option in product.options_with_values -%}
                        {%- liquid
                          assign option_downcase = option.name | downcase
                        -%}
                          {% assign optionCounter = forloop.length %}
                      {% if color_label contains option_downcase %}
                          {%- assign option_index = forloop.index0 -%}
                          {%- assign values = '' -%}
                        {%- for value in option.values -%}
                          {% assign optionCount = forloop.length %}
                        {% endfor %}
                            {%- for variant in product.variants -%}
                              {%- assign value = variant.options[option_index] %}
                              {%- unless values contains value -%}
                                  {% assign variant_value = value | downcase %}
                                  {%- liquid
                                        assign values = values | join: ','
                                        assign values = values | append: ',' | append: value
                                        assign values = values | split: ','
                                        assign color_image = value | handle | append: '.' | append: 'png' | file_img_url: 'master' | prepend: 'https:'
                                        assign color_swatch_fallback = value | split: ' ' | last | handle
                                        assign color_count = color_count | plus: 1
                                      -%}
                                    {% if colorCount <= 4 %}
                                      <div class="color_swatch">
                                        <label class="swatch-label {% if forloop.first %}active{% endif %}" data-value= "{{value}}"  data-variant-id="{{ variant.id }}" >
                                          <span class="color-box" data-image ="{{ variant.image.src | product_img_url: 'master' }}"  style="background-image: url({{ color_image }}); background-color: {{ color_swatch_fallback }};"></span>
                                          <span class="tool-tip"> {{ value | capitalize }}</span>
                                        </label>
                                     </div>
                                      {% else %}
                                        {% if colorCount == 5 %}
                                          <div class="group-swatch" style="display: none">
                                        {% endif %}
                                     
                                       
                                          <div class="color_swatch">
                                          <label class="swatch-label {% if forloop.first %}active{% endif %}" data-value= "{{value}}"  data-variant-id="{{ variant.id }}" >
                                              <span class="color-box" data-image ="{{ variant.image.src | product_img_url: 'master' }}"  style="background-image: url({{ color_image }}); background-color: {{ color_swatch_fallback }};"></span>
                                              <span class="tool-tip"> {{ value | capitalize }}</span>
                                            </label>
                                           
                                          </div>
                                         
                                        {% if colorCount == optionCount %}
                                          </div>
                                          <div class="item-swatch-more item"><button type="button" class="number-showmore" title="More Color"><span class="swatch-plus">+</span><span class="swatch-minus">-</span> <span class="text-number">{{ colorCount | minus : 4 }}</span></button></div>
                                        {% endif %}
                                    {% endif %}
                               {% assign colorCount = colorCount | plus : 1 %}
                            {%- endunless -%}
                              {%- assign count = count | plus : 1 -%}
                          {%- endfor -%}
                        {% break %}
                        {%- endif -%}
                        {%- endfor -%}
             </div>       
          {%- endif -%}
         {%- assign truncate_desc =  settings.show_description | plus: 0 -%}
        {%- if truncate_desc > 0 and product_card_product.description.size > 0 -%}
        <div class="product-desc"> {{ product_card_product.description | strip_html | truncate: truncate_desc  }}</div>
         {%- endif -%}
      </div>
    </div>
</div>
