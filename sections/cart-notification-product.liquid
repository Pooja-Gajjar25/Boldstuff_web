{% assign relatedTag = false %}
{%- for item in cart.items -%}
  {% for tag in item.product.tags %}
    {% if tag contains 'related_' %}
        {% assign relatedTag = true %}
    {% endif %}
  {% endfor %}
{% endfor %}

{% assign motivatorProduct = all_products[settings.product] %}
{%- assign check_gift = false -%}
  {%- for item in cart.items -%}
    {% if item.id == motivatorProduct.selected_or_first_available_variant.id %}
      {%- assign check_gift = true -%}
    {% endif %}
{% endfor %}
{%- if cart != empty -%}
  <!--
    <div class="cart-notification__header">
      <h2 class="cart-notification__heading caption-large alert-success">{% render 'icons' with 'checkmark' %} {{ 'general.cart.modified_cart' | t }}</h2>
    </div>
  -->
  <div class="slimScrollDiv{% if cart == empty %} cart-empty-notification{% endif %}">
    {% unless cart == empty %}
       {% assign shipping_amount = settings.shipping_amount | times: 100 %}
      {% if settings.show_shipping_price %}
        {% assign motivatorProduct = all_products[settings.product] %}
        {% assign final_amount_price = shipping_amount | minus: cart.total_price %}
      {% else %}
        {% if check_gift %}
          {% assign final_amount_price = shipping_amount | minus: cart.total_price | plus: motivatorProduct.price %}
        {% else %}
          {% assign final_amount_price = shipping_amount | minus: cart.total_price %}
        {% endif %}
      {% endif %}
      {% assign shipping_amount_price = final_amount_price | money %}
      {% assign progressBarWidth = final_amount_price | divided_by: settings.shipping_amount %}
      {% assign finalProgressBarWidth = 100 | minus: progressBarWidth %}
      {%- if settings.shipping_amount > 0 -%}
        <div class="shipping_amount_html">
          <span class="cart_empty_shipping_text">
            {%- if cart.total_price < shipping_amount %}
              <h2 class="cart-notification__heading caption-large free-shipping-success">
                {{ 'general.cart.free_shipping_indicator_infolabel' | t: shipping_amount: shipping_amount_price }}
                <p>{{ 'general.cart.free_shipping_indicator_infolabel2' | t }}</p>
              </h2>
              <div
                class="progress{% if cart.item_count == 0 %} progress-hidden{% endif %}"
                data-text-enabled="false"
                data-shipping-progress
              >
                <div class="progress_shipping" role="progressbar">
                  <div
                    class="progress-meter"
                    style="width: {{ finalProgressBarWidth }}%; transition: .9s;"
                    data-free-shipping-progress-meter
                  >
                    <div class="progress-truck-wrapper">
                      {% render 'icons' with 'icon-shipping-truck' %}
                    </div>
                  </div>
                </div>
              </div>
            {% else %}
              <h2 class="cart-notification__heading caption-large free-shipping-succes-eligible">
                <span>
                  {{ 'general.cart.free_shipping_indicator_congratulations' | t }}
                  <p>{{ 'general.cart.free_shipping_indicator_successlabel' | t }}</p>
                </span>
              </h2>
              <div
                class="progress{% if cart.item_count == 0 %} progress-hidden{% endif %}"
                data-text-enabled="false"
                data-shipping-progress
              >
                <div class="progress_shipping" role="progressbar">
                  <div class="progress-meter" style="width: 100%" data-free-shipping-progress-meter>
                    <div class="progress-truck-wrapper">
                      {% render 'icons' with 'icon-shipping-truck' %}
                    </div>
                  </div>
                </div>
              </div>
            {% endif -%}
          </span>
        </div>
      {%- endif -%}
    {%- endunless -%}
  
    {%- for item in cart.items -%}
      {% unless item.id == motivatorProduct.selected_or_first_available_variant.id %} 
        <div id="cart-notification-product-{{ item.id }}" class="cart-notification-product">
        <a href="{{ item.product.url }}" class="cart-notification-item">
          {% if item.image %}
            <img
              class="cart-notification-product__image"
              src="{{ item.image | img_url: '140x' }}"
              alt="{{ item.image.alt | escape }}"
              width="120"
              height="{{ 120 | divided_by: item.image.aspect_ratio | ceil }}"
              loading="lazy"
            >
          {% endif %}
          <div class="cart-notification-product__info">
            <h3 class="cart-notification-product__name h4">{{ item.product.title | escape }}</h3>
            {%- unless item.product.has_only_default_variant -%}
              <div class="cart-notification-product__option h4">
                {%- for option in item.options_with_values -%}
                  <span>{{ option.value }} </span>
                  {%- unless forloop.last == true -%}/{%- endunless -%}
                {%- endfor -%}
              </div>
            {%- endunless -%}

            <div class="cart-notification-product__qty-price h4">
              {{ item.quantity }} X {{ item.original_price | money }}
            </div>
            <quantity-input class="quantity">
              <button
                class="quantity__button no-js-hidden minicart-quantity__button"
                name="minus"
                type="button"
                data-variantid="{{ item.id }}"
              >
                <span class="visually-hidden">
                  {{- 'products.product.quantity.decrease' | t: product: item.product.title | escape -}}
                </span>
                &minus;
              </button>
              <input
                class="quantity__input"
                type="number"
                name="updates[]"
                value="{{ item.quantity }}"
                min="0"
                aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                id="Quantity-{{ item.index | plus: 1 }}"
                data-index="{{ item.index | plus: 1 }}"
              >
              <button
                class="quantity__button no-js-hidden minicart-quantity__button"
                name="plus"
                type="button"
                data-variantid="{{ item.id }}"
              >
                <span class="visually-hidden">
                  {{- 'products.product.quantity.increase' | t: product: item.product.title | escape -}}
                </span>
                &plus;
              </button>
            </quantity-input>
            {%- for property in item.properties -%}
              {%- assign property_first_char = property.first | slice: 0 -%}
              {%- if property.last != blank and property_first_char != '_' -%}
                <div class="cart-notification-product__lineitem">
                  <span>{{ property.first }}: </span>
                  <span>
                    {%- if property.last contains '/uploads/' -%}
                      {{ property.last | split: '/' | last }}
                    {%- else -%}
                      {{ property.last }}
                    {%- endif -%}
                  </span>
                </div>
              {%- endif -%}
            {%- endfor -%}
            {%- if item.selling_plan_allocation != null -%}
              <div class="cart-notification-product__option h4">
                {{ item.selling_plan_allocation.selling_plan.name }}
              </div>
            {%- endif -%}
          </div>
        </a>
        <span class="cart-remove-js" data-variantid="{{ item.id }}">
          {% render 'icons' with 'remove' %}
        </span>
      </div>
      {% endunless %}
    {%- endfor -%}
              
   
  </div>
  
{%- else -%}
  <div class="cart-notification__header cart-empty">
    {%- if settings.shipping_amount > 0 -%}
      {% assign shipping_amount = settings.shipping_amount | times: 100 %}
      {% assign shipping_amount_price = shipping_amount | money %}
      {% assign progressBarWidth = final_amount_price | divided_by: settings.shipping_amount %}
      {% assign finalProgressBarWidth = 100 | minus: progressBarWidth %}
      <div class="shipping_amount_html">
        <span class="cart_empty_shipping_text">
          <h2 class="cart-notification__heading caption-large free-shipping-success">
            {{ 'general.cart.free_shipping_indicator_infolabel' | t: shipping_amount: shipping_amount_price }}
            <p>{{ 'general.cart.free_shipping_indicator_infolabel2' | t }}</p>
          </h2>
          <div
            class="progress{% if cart.item_count == 0 %} progress-hidden{% endif %}"
            data-text-enabled="false"
            data-shipping-progress
          >
            <div class="progress_shipping" role="progressbar">
              <div class="progress-meter" style="width: 0%" data-free-shipping-progress-meter>
                <div class="progress-truck-wrapper">
                  {% render 'icons' with 'icon-shipping-truck' %}
                </div>
              </div>
            </div>
          </div>
        </span>
      </div>
    {%- endif -%}
    <h2 class="cart-notification__heading caption-large">
      <span class="cart_empty_title"> {{ 'general.cart.cart_empty' | t }}</span>
    </h2>
  </div>
{%- endif -%}